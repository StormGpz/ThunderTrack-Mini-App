<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThunderTrack SDK Direct Test</title>
    
    <!-- Farcaster Mini App Embed -->
    <meta name="fc:miniapp" content='{"version":"1","imageUrl":"https://thundertrack-miniapp.vercel.app/icons/Icon-512.png","button":{"title":"ğŸ”§ SDKç›´æ¥æµ‹è¯•","action":{"type":"launch_miniapp","name":"ThunderTrack SDK Direct","url":"https://thundertrack-miniapp.vercel.app/sdk_direct_test.html","splashImageUrl":"https://thundertrack-miniapp.vercel.app/icons/Icon-512.png","splashBackgroundColor":"#6366f1"}}}' />
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        .container {
            text-align: center;
            max-width: 400px;
            margin: 50px auto;
        }
        .logo { font-size: 60px; margin-bottom: 20px; }
        .title { font-size: 32px; font-weight: bold; margin-bottom: 10px; }
        .subtitle { font-size: 16px; opacity: 0.9; margin-bottom: 30px; }
        .card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .status { color: #fbbf24; font-weight: bold; font-size: 16px; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .button {
            background: white;
            color: #6366f1;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px auto;
            width: 90%;
            display: block;
        }
        .button:hover { background: #f3f4f6; }
        .logs {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">âš¡</div>
        <div class="title">ThunderTrack</div>
        <div class="subtitle">SDKç›´æ¥åŠ è½½æµ‹è¯•</div>
        
        <div class="card">
            <div style="font-size: 20px; font-weight: bold; margin-bottom: 10px;">ğŸ”§ SDKç›´æ¥åŠ è½½çŠ¶æ€</div>
            <div>SDKçŠ¶æ€: <span class="status" id="sdk-status">æ£€æµ‹ä¸­...</span></div>
            <div>ReadyçŠ¶æ€: <span class="status" id="ready-status">æœªè°ƒç”¨</span></div>
            <div>Context: <span class="status" id="context-status">æœªæ£€æµ‹</span></div>
        </div>
        
        <button class="button" onclick="testReady()">
            ğŸš€ è°ƒç”¨Readyå‡½æ•°
        </button>
        
        <button class="button" onclick="testSDKFeatures()">
            ğŸ” æµ‹è¯•SDKåŠŸèƒ½
        </button>
        
        <button class="button" onclick="forceReady()">
            âš¡ å¼ºåˆ¶Ready (å¿½ç•¥é”™è¯¯)
        </button>
        
        <div class="card">
            <strong>ğŸ” å®æ—¶æ—¥å¿—:</strong>
            <div class="logs" id="logs"></div>
        </div>
    </div>

    <!-- ç›´æ¥ä½¿ç”¨scriptæ ‡ç­¾åŠ è½½SDK -->
    <script src="https://unpkg.com/@farcaster/miniapp-sdk@latest/dist/index.umd.js"></script>
    
    <script>
        let logs = [];
        let sdkReady = false;
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'ğŸ“';
            const logMessage = `${icon} [${timestamp}] ${message}`;
            
            logs.push(logMessage);
            const logElement = document.getElementById('logs');
            logElement.innerHTML = logs.slice(-15).join('<br>');
            logElement.scrollTop = logElement.scrollHeight;
            console.log(logMessage);
        }
        
        // æ£€æµ‹SDKåŠ è½½çŠ¶æ€
        function checkSDKStatus() {
            addLog('ğŸ”„ å¼€å§‹æ£€æµ‹SDKçŠ¶æ€...');
            
            if (typeof window.FarcasterMiniAppSDK !== 'undefined') {
                addLog('âœ… SDKå…¨å±€å¯¹è±¡å·²åŠ è½½', 'success');
                document.getElementById('sdk-status').innerHTML = '<span class="success">âœ… å·²åŠ è½½</span>';
                
                // æ£€æµ‹SDKç»“æ„
                const sdk = window.FarcasterMiniAppSDK;
                if (sdk.actions) {
                    addLog('âœ… SDK.actions å¯¹è±¡å­˜åœ¨', 'success');
                    if (sdk.actions.ready) {
                        addLog('âœ… SDK.actions.ready æ–¹æ³•å­˜åœ¨', 'success');
                        // ç«‹å³å°è¯•è°ƒç”¨ready
                        callReady();
                    } else {
                        addLog('âŒ SDK.actions.ready æ–¹æ³•ä¸å­˜åœ¨', 'error');
                    }
                } else {
                    addLog('âŒ SDK.actions å¯¹è±¡ä¸å­˜åœ¨', 'error');
                }
                
                if (sdk.context) {
                    addLog('âœ… SDK.context å¯¹è±¡å­˜åœ¨', 'success');
                    document.getElementById('context-status').innerHTML = '<span class="success">âœ… å·²åŠ è½½</span>';
                    if (sdk.context.location) {
                        addLog(`ğŸ“ Context location: ${sdk.context.location.type}`, 'info');
                    }
                } else {
                    addLog('âŒ SDK.context å¯¹è±¡ä¸å­˜åœ¨', 'error');
                }
                
            } else {
                addLog('âŒ SDKæœªæ‰¾åˆ°ï¼Œå¯èƒ½åŠ è½½å¤±è´¥', 'error');
                document.getElementById('sdk-status').innerHTML = '<span class="error">âŒ æœªåŠ è½½</span>';
                
                // æ£€æµ‹å¯èƒ½çš„å…¶ä»–å…¨å±€å˜é‡
                addLog('ğŸ” æ£€æµ‹å¯èƒ½çš„å…¨å±€å˜é‡...');
                if (window.farcaster) addLog('ğŸ” å‘ç° window.farcaster');
                if (window.miniapp) addLog('ğŸ” å‘ç° window.miniapp');
                if (window.sdk) addLog('ğŸ” å‘ç° window.sdk');
            }
        }
        
        // è°ƒç”¨Readyå‡½æ•°
        async function callReady() {
            if (typeof window.FarcasterMiniAppSDK === 'undefined') {
                addLog('âŒ SDKæœªåŠ è½½ï¼Œæ— æ³•è°ƒç”¨ready', 'error');
                return false;
            }
            
            try {
                const sdk = window.FarcasterMiniAppSDK;
                addLog('ğŸ”„ å‡†å¤‡è°ƒç”¨ sdk.actions.ready()...');
                
                if (sdk.actions && typeof sdk.actions.ready === 'function') {
                    await sdk.actions.ready();
                    addLog('ğŸ‰ sdk.actions.ready() è°ƒç”¨æˆåŠŸï¼', 'success');
                    document.getElementById('ready-status').innerHTML = '<span class="success">âœ… æˆåŠŸè°ƒç”¨</span>';
                    sdkReady = true;
                    return true;
                } else {
                    addLog('âŒ readyå‡½æ•°ä¸å­˜åœ¨æˆ–ä¸æ˜¯å‡½æ•°', 'error');
                    return false;
                }
            } catch (error) {
                addLog(`âŒ è°ƒç”¨readyå¤±è´¥: ${error.message}`, 'error');
                console.error('Ready call error:', error);
                return false;
            }
        }
        
        // æ‰‹åŠ¨æµ‹è¯•Ready
        function testReady() {
            addLog('ğŸ‘† ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨readyæµ‹è¯•...');
            callReady();
        }
        
        // å¼ºåˆ¶Readyï¼ˆå¿½ç•¥é”™è¯¯ï¼‰
        function forceReady() {
            addLog('âš¡ å¼ºåˆ¶è°ƒç”¨readyï¼ˆå¿½ç•¥æ‰€æœ‰é”™è¯¯ï¼‰...');
            try {
                if (window.FarcasterMiniAppSDK && window.FarcasterMiniAppSDK.actions) {
                    window.FarcasterMiniAppSDK.actions.ready().catch(e => {
                        addLog(`âš ï¸ å¼ºåˆ¶readyæœ‰é”™è¯¯ä½†ç»§ç»­: ${e.message}`, 'error');
                    });
                    addLog('âš¡ å¼ºåˆ¶readyå·²å‘é€', 'success');
                    document.getElementById('ready-status').innerHTML = '<span class="success">âš¡ å¼ºåˆ¶è°ƒç”¨</span>';
                } else {
                    addLog('âŒ æ— æ³•å¼ºåˆ¶è°ƒç”¨ï¼šSDKç»“æ„ä¸æ­£ç¡®', 'error');
                }
            } catch (error) {
                addLog(`âŒ å¼ºåˆ¶è°ƒç”¨ä¹Ÿå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•SDKåŠŸèƒ½
        function testSDKFeatures() {
            if (typeof window.FarcasterMiniAppSDK === 'undefined') {
                alert('âŒ SDKæœªåŠ è½½');
                return;
            }
            
            const sdk = window.FarcasterMiniAppSDK;
            const features = {
                'SDKå¯¹è±¡': !!sdk,
                'actionså¯¹è±¡': !!sdk.actions,
                'readyæ–¹æ³•': !!(sdk.actions && sdk.actions.ready),
                'readyç±»å‹': sdk.actions ? typeof sdk.actions.ready : 'N/A',
                'contextå¯¹è±¡': !!sdk.context,
                'locationä¿¡æ¯': sdk.context ? sdk.context.location?.type : 'N/A'
            };
            
            let info = 'SDKåŠŸèƒ½æ£€æµ‹ç»“æœ:\n\n';
            for (const [key, value] of Object.entries(features)) {
                info += `${key}: ${value}\n`;
            }
            
            alert(info);
            addLog('ğŸ” ç”¨æˆ·æŸ¥çœ‹äº†SDKåŠŸèƒ½æ£€æµ‹ç»“æœ');
        }
        
        // é¡µé¢åŠ è½½åç«‹å³æ£€æµ‹
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ“„ DOMå·²åŠ è½½å®Œæˆ');
            checkSDKStatus();
        });
        
        // å¦‚æœDOMå·²ç»åŠ è½½å®Œæˆï¼Œç«‹å³æ‰§è¡Œ
        if (document.readyState === 'loading') {
            // DOMè¿˜åœ¨åŠ è½½ä¸­ï¼Œç­‰å¾…DOMContentLoadedäº‹ä»¶
            addLog('â³ DOMæ­£åœ¨åŠ è½½ä¸­...');
        } else {
            // DOMå·²ç»åŠ è½½å®Œæˆ
            addLog('ğŸ“„ DOMå·²å°±ç»ªï¼Œç«‹å³æ£€æµ‹SDK');
            checkSDKStatus();
        }
        
        // è®¾ç½®å®šæ—¶å™¨æŒç»­ç›‘æ§SDKçŠ¶æ€
        let checkInterval = setInterval(() => {
            if (!sdkReady && typeof window.FarcasterMiniAppSDK !== 'undefined') {
                addLog('ğŸ”„ å®šæ—¶æ£€æµ‹åˆ°SDKå¯ç”¨ï¼Œå°è¯•è°ƒç”¨ready...');
                if (callReady()) {
                    clearInterval(checkInterval);
                }
            }
        }, 1000);
        
        // 5åˆ†é’Ÿååœæ­¢å®šæ—¶æ£€æµ‹
        setTimeout(() => {
            clearInterval(checkInterval);
            addLog('â° åœæ­¢å®šæ—¶æ£€æµ‹');
        }, 300000);
    </script>
</body>
</html>